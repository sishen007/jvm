### Java 运行时环境-JRE

JRE仅包含运行Java程序的必须组件，包括Java虚拟机以及Java核心类库等。

JDK（Java开发工具包）同样包含了JRE，并附带一系列开发、诊断工具。

Java虚拟机将运行时内存区域划为五个部分：

1. 方法区
2. 堆
3. PC寄存器
4. Java方法栈
5. 本地方法栈

### Java在虚拟机中运行的原因

1. Java程序 -》编译 -》Java字节码（.class文件）-》JVM解析运行
2. 虚拟机中带有托管环境，这个托管环境能够代替处理一些代码中冗长且容易出错的部分。其中最广为人知的当属自动内存管理与垃圾回收。
3. 托管环境提供数组越界、动态类型、安全权限等的动态检测，让我们免于书写这些无关业务逻辑的代码。

Java虚拟机运行Java字节码流程

1. 虚拟机角度

   Java虚拟机将栈分为面向Java方法的Java方法栈，面详本地方法的本地方法栈，存放各个线程执行位置的PC寄存器。

   class文件加载到Java虚拟机，将Java类存放于方法区，实际运行时，虚拟机会执行方法区内的代码。

2. 硬件角度

   HotSpot中，将字节码翻译成机器码两种形式

   - 解释执行，即逐条将字节码翻译成机器码并执行
   - 即时编译（JIT），即将一个方法中包含的所有字节码编译成机器码后再执行。

### Java虚拟机运行效率

HotSpot采用多种技术来提升启动性能以及峰值性能，即时编译即其中最重要的技术之一。

为了提高运行效率，标准JDK中的HotSpot虚拟机采用的是一种混合执行的策略。

虚拟机解释执行Java字节码，然后会将其中反复执行的热点代码，以方法为单位进行即时编译，编译成机器码后直接运行在底层硬件上。

HotSpot装载了多个不同的即时编译器（C1，C2，Graal），以便在编译时间和生成代码的执行效率之间做取舍。













